const BaseURL="https://app.seia.io/Ohys-Fanmade/",OriginalURL="https://torrents.ohys.net/t/",ResolutionPattern=/\d{3,4}x\d{3,4}/;let ViewList="new",ViewPage=0,ViewLast={name:"",uri:""},ViewMode=1;function setCookie(e,t,o){let n="";if(o){const e=new Date;e.setTime(e.getTime()+24*o*60*60*1e3),n="; expires="+e.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"}function getCookie(e){let t=e+"=",o=document.cookie.split(";");for(var n=0;n<o.length;n++){let e=o[n];for(;" "==e.charAt(0);)if(0==(e=e.substring(1,e.length)).indexOf(t))return e.substring(t.length,e.length)}return null}function eraseCookie(e){document.cookie=e+"=; Max-Age=-99999999;"}function appendTable(e){const t=document.querySelector("#TorrentTable");let o=t.insertRow(t.rows.length),n={torrent:o.insertCell(0),resolution:o.insertCell(1),download:o.insertCell(2)};n.torrent.innerHTML=e.torrent,n.resolution.innerHTML=e.resolution,n.download.innerHTML=e.download}function clearTable(e){document.querySelector("#TorrentTable").innerHTML=e||""}function requestData(e){return new Promise(function(t,o){let n=new XMLHttpRequest;n.open("GET",e,!1),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; Charset=utf-8"),n.send(null),4===n.readyState&&200===n.status?t(n.responseText):o(n.status)})}function makeList(e){const t=document.querySelector("#SearchInput"),o=document.querySelector("#DirSelector");o.value!==ViewList&&(ViewList=o.value,ViewPage=0);let n=BaseURL+"json.php?dir="+(o.value||ViewList)+"&p="+ViewPage;e.includeInput&&""!==t.value&&(n+="&q="+t.value),e.clearTable&&clearTable("Loading..."),requestData(n).then(function(t){e.clearTable&&clearTable("");const o=JSON.parse(t);if(o[0]){if(ViewLast.name===o[0].t&&ViewLast.uri!==n)return void alert("End of results! There is no more data to append.");ViewLast={name:o[0].t,uri:n},o.forEach(function(e){const t=e.t,o=t.match(ResolutionPattern)||"Not recognized";appendTable({torrent:t,resolution:o,download:'<a href="'+OriginalURL+e.a+'">Download</a>'})})}else e.clearTable&&clearTable("No results.")})}function rebuildList(e){ViewList=e.ViewList||ViewList,ViewPage=e.ViewPage||ViewPage,makeList({includeInput:!1,clearTable:!0})}function downloadList(){Object.values(TorrentTable.rows).forEach(function(e,t){setTimeout(function(){window.location=e.querySelector("a").href},900+900*t)})}function switchTheme(){const e=document.querySelector("body"),t=document.querySelector("#app"),o=document.querySelector("#SearchButton"),n=document.querySelector("#LoadmoreButton");0==ViewMode?(e.style["background-color"]="#232b2b",t.style.color="white",o.style.color="white",n.style.color="white",ViewMode=1):(e.style["background-color"]="white",t.style.color="black",o.style.color="black",n.style.color="black",ViewMode=0)}function setMode(){switchTheme(),eraseCookie("nightmode"),setCookie("nightmode",0==ViewMode?"1":"0",7)}document.addEventListener("DOMContentLoaded",function(e){ViewMode=getCookie("nightmode")||1,switchTheme(),makeList({includeInput:!1,clearTable:!1})});
