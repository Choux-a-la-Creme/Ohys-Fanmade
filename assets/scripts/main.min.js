const BaseURL="https://app.seia.io/Ohys-Fanmade/",OriginalURL="https://torrents.ohys.net/t/",ResolutionPattern=/\d{3,4}x\d{3,4}/;let ViewList="new",ViewPage=0,ViewLast={name:"",uri:""};function appendTable(e){const t=document.querySelector("#TorrentTable");let n=t.insertRow(t.rows.length),a={torrent:n.insertCell(0),resolution:n.insertCell(1),download:n.insertCell(2)};a.torrent.innerHTML=e.torrent,a.resolution.innerHTML=e.resolution,a.download.innerHTML=e.download}function clearTable(e){document.querySelector("#TorrentTable").innerHTML=e||""}function requestData(e){return new Promise(function(t,n){let a=new XMLHttpRequest;a.open("GET",e,!1),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; Charset=utf-8"),a.send(null),4===a.readyState&&200===a.status?t(a.responseText):n(a.status)})}function makeList(e){const t=document.querySelector("#SearchInput"),n=document.querySelector("#DirSelector");n.value!==ViewList&&(ViewList=n.value,ViewPage=0);let a=BaseURL+"json.php?dir="+(n.value||ViewList)+"&p="+ViewPage;e.includeInput&&""!==t.value&&(a+="&q="+t.value),e.clearTable&&clearTable("Loading..."),requestData(a).then(function(t){e.clearTable&&clearTable("");const n=JSON.parse(t);if(n[0]){if(ViewLast.name===n[0].t&&ViewLast.uri!==a)return void alert("End of results! There is no more data to append.");ViewLast={name:n[0].t,uri:a},n.forEach(function(e){const t=e.t,n=t.match(ResolutionPattern)||"Not recognized";appendTable({torrent:t,resolution:n,download:'<a href="'+OriginalURL+e.a+'">Download</a>'})})}else e.clearTable&&clearTable("No results.")})}function rebuildList(e){ViewList=e.ViewList||ViewList,ViewPage=e.ViewPage||ViewPage,makeList({includeInput:!1,clearTable:!0})}function downloadList(){Object.values(TorrentTable.rows).forEach(function(e,t){setTimeout(function(){window.location=e.querySelector("a").href},900+900*t)})}document.addEventListener("DOMContentLoaded",function(e){makeList({includeInput:!1,clearTable:!1})});
